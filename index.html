<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>BOI CRM — IndusFood</title>
  <link rel="icon" href="favicon.ico"/>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <img class="logo" src="boi-logo.png" alt="BOI"/>
      <div class="brandtext">
        <div class="title">BOI CRM — IndusFood</div>
        <div class="subtitle">Blue Orbit International LLP • Lead Capture</div>
      </div>
    </div>

    <div class="top-actions">
      <div class="userpill">
        <span class="muted">User:</span> <span id="userNameLabel">—</span>
        <button class="btn btn-ghost btn-sm" id="btnSwitchUser">Switch</button>
      </div>
      <button class="btn btn-ghost" id="btnSettings">Settings</button>
    </div>
  </header>

  <nav class="tabs">
    <button class="tab active" data-tab="capture">Capture</button>
    <button class="tab" data-tab="dashboard">Dashboard</button>
    <button class="tab" data-tab="leads">Leads</button>
    <button class="tab" data-tab="calendar">Calendar</button>
  </nav>

  <main class="shell">
    <!-- CAPTURE -->
    <section class="panel" id="tab-capture">
      <div class="panel-head">
        <div class="seg">
          <span class="muted">LEAD TYPE</span>
          <button class="segbtn active" id="btnTypeSupplier">Supplier</button>
          <button class="segbtn" id="btnTypeBuyer">Buyer</button>
        </div>

        <div class="right">
          <button class="btn btn-ghost" id="btnScan" disabled>Scan QR (optional)</button>
          <div class="status">
            <div class="small muted">Status</div>
            <div id="statusText" class="small">Not configured</div>
            <div class="tiny muted">Tip: set user + Apps Script URL in Settings.</div>
          </div>
        </div>
      </div>

      <div class="grid2">
        <div class="card">
          <div class="card-title" id="captureTitle">Supplier details</div>
          <div class="card-sub">Fill manually or scan. Attach catalog/card images if available.</div>

          <div class="formgrid">
            <div>
              <label>Company name <span class="req">*</span></label>
              <input id="company" autocomplete="organization"/>
            </div>
            <div>
              <label>Contact person</label>
              <input id="contact" autocomplete="name"/>
            </div>

            <div>
              <label>Title</label>
              <input id="title" autocomplete="organization-title"/>
            </div>
            <div>
              <label>Email</label>
              <input id="email" type="email" autocomplete="email"/>
            </div>

            <div>
              <label>Country (type to search)</label>
              <input id="country" list="dlCountries" placeholder="Search country..."/>
              <datalist id="dlCountries"></datalist>
            </div>
            <div>
              <label>Markets / Notes (type to search)</label>
              <input id="markets" list="dlMarkets" placeholder="Search markets..."/>
              <datalist id="dlMarkets"></datalist>
            </div>

            <div>
              <label>Phone 1 (WhatsApp ok)</label>
              <input id="phone1" placeholder="+91 ..." inputmode="tel" autocomplete="tel"/>
            </div>
            <div>
              <label>Phone 2 (optional)</label>
              <input id="phone2" placeholder="+91 ..." inputmode="tel" autocomplete="tel"/>
            </div>

            <div>
              <label>Website</label>
              <input id="website" placeholder="https://..." autocomplete="url"/>
            </div>
            <div>
              <label>Social</label>
              <input id="social" placeholder="@company"/>
            </div>

            <div>
              <label>Product Type (type to search)</label>
              <input id="productType" list="dlProductTypes" placeholder="Search product type..."/>
              <datalist id="dlProductTypes"></datalist>
            </div>
            <div>
              <label>Private label?</label>
              <select id="privateLabel">
                <option value=""></option>
                <option>Private label</option>
                <option>Own brand</option>
                <option>Not sure</option>
              </select>
            </div>

            <div>
              <label>Price — Ex-Factory</label>
              <input id="exFactory" placeholder="USD / unit"/>
            </div>
            <div>
              <label>Price — FOB</label>
              <input id="fob" placeholder="USD / unit"/>
            </div>

            <div class="span2">
              <label id="productsLabel">What do they sell? (one per line) <span class="req">*</span></label>
              <textarea id="productsOrNeeds" rows="4" placeholder="One item per line"></textarea>
            </div>

            <div class="span2">
              <label>Attach catalog / docs (optional · multiple)</label>
              <input id="catalogFiles" type="file" multiple accept="image/*,application/pdf"/>
            </div>

            <div class="span2">
              <label>Attach card image (optional)</label>
              <input id="cardFile" type="file" accept="image/*"/>
            </div>

            <div class="span2">
              <label>QR raw (auto-filled if scanned)</label>
              <textarea id="qrData" rows="2" placeholder="(optional)"></textarea>
            </div>

            <div class="span2">
              <label>Notes</label>
              <textarea id="notes" rows="3"></textarea>
            </div>
          </div>

          <div class="follow">
            <div class="follow-head">
              <div class="follow-title">Schedule follow-up (IST)</div>
              <label class="toggle">
                <input type="checkbox" id="followEnabled"/>
                <span>Enable</span>
              </label>
            </div>
            <div class="follow-grid">
              <div>
                <label>Date</label>
                <input id="followDate" type="date"/>
              </div>
              <div>
                <label>Time</label>
                <input id="followTime" type="time"/>
              </div>
              <div class="span2">
                <label>Follow-up note</label>
                <input id="followNote" placeholder="Call / WhatsApp / send catalog / pricing..."/>
              </div>
            </div>
          </div>

          <div class="actions">
            <button class="btn btn-primary" id="btnSaveNew">Save & New</button>
            <button class="btn btn-primary" id="btnSaveClose">Save & Close</button>
            <button class="btn btn-ghost" id="btnClear">Clear</button>
            <div class="saving" id="savingIndicator">Saving…</div>
          </div>
        </div>

        <div class="card">
          <div class="card-title">Session leads</div>
          <div class="card-sub">This device only. Master record is in your Google Sheet.</div>

          <div class="tablewrap">
            <table class="table" id="sessionTable">
              <thead>
                <tr><th>Type</th><th>Company</th><th>Country</th><th>Time (IST)</th></tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <div class="tiny muted" id="sessionCount">0 leads this session</div>
        </div>
      </div>
    </section>

    <!-- DASHBOARD -->
    <section class="panel hidden" id="tab-dashboard">
      <div class="panel-head">
        <div class="filters">
          <input id="fCountry" list="dlCountries" placeholder="Filter: Country (contains)"/>
          <input id="fProductType" list="dlProductTypes" placeholder="Filter: Product Type (contains)"/>
          <input id="fMarkets" list="dlMarkets" placeholder="Filter: Markets (contains)"/>
          <button class="btn btn-ghost" id="btnClearFilters">Clear filters</button>
        </div>
      </div>

      <div class="kpis">
        <div class="kpi"><div class="kpi-label">Total leads</div><div class="kpi-val" id="kpiTotal">0</div></div>
        <div class="kpi"><div class="kpi-label">Suppliers</div><div class="kpi-val" id="kpiSuppliers">0</div></div>
        <div class="kpi"><div class="kpi-label">Buyers</div><div class="kpi-val" id="kpiBuyers">0</div></div>
        <div class="kpi"><div class="kpi-label">Upcoming follow-ups</div><div class="kpi-val" id="kpiFollowups">0</div></div>
      </div>

      <div class="grid2">
        <div class="card">
          <div class="card-title">Upcoming follow-ups</div>
          <div class="tablewrap">
            <table class="table" id="followupsTable">
              <thead><tr><th>When (IST)</th><th>Type</th><th>Company</th><th>Note</th><th></th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <div class="card">
          <div class="card-title">Recent leads</div>
          <div class="tablewrap">
            <table class="table" id="recentLeadsTable">
              <thead><tr><th>When (IST)</th><th>Type</th><th>Company</th><th>Country</th><th></th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- LEADS -->
    <section class="panel hidden" id="tab-leads">
      <div class="panel-head">
        <div class="filters">
          <input id="lCountry" list="dlCountries" placeholder="Country (contains)"/>
          <input id="lProductType" list="dlProductTypes" placeholder="Product Type (contains)"/>
          <input id="lMarkets" list="dlMarkets" placeholder="Markets (contains)"/>
          <button class="btn btn-ghost" id="btnRefreshLeads">Refresh</button>
        </div>
      </div>

      <div class="card">
        <div class="tablewrap">
          <table class="table" id="leadsTable">
            <thead>
              <tr>
                <th>When</th><th>Type</th><th>Company</th><th>Contact</th><th>Country</th><th>Product</th><th>Markets</th><th>Owner</th><th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- CALENDAR -->
    <section class="panel hidden" id="tab-calendar">
      <div class="panel-head">
        <div class="seg">
          <button class="segbtn active" id="calViewAgenda">Agenda</button>
          <button class="segbtn" id="calViewWeek">Week</button>
          <button class="segbtn" id="calViewMonth">Month</button>
        </div>
      </div>

      <div class="card" id="calAgenda">
        <div class="card-title">Follow-ups (agenda)</div>
        <div class="tablewrap">
          <table class="table" id="calendarTable">
            <thead><tr><th>When (IST)</th><th>Company</th><th>Type</th><th>Note</th><th>Calendar</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div class="grid2 hidden" id="calGrid">
        <div class="card">
          <div class="card-title" id="calGridTitle">Calendar</div>
          <div id="calendarGrid" class="calgrid"></div>
        </div>
        <div class="card">
          <div class="card-title">Details</div>
          <div id="calDetails" class="small muted">Select a follow-up to see details.</div>
        </div>
      </div>
    </section>
  </main>

  <!-- SETTINGS MODAL -->
  <div class="overlay hidden" id="settingsOverlay" aria-hidden="true">
    <div class="modal">
      <div class="modal-head">
        <div class="modal-title">Settings</div>
        <button class="btn btn-ghost btn-sm" id="btnCloseSettings">Close</button>
      </div>

      <label class="muted small">Apps Script Web App URL (must end with /exec)</label>
      <input id="settingsScriptUrl" placeholder="https://script.google.com/macros/s/.../exec"/>

      <div class="row">
        <button class="btn btn-ghost" id="btnTest">Test connection</button>
        <button class="btn btn-primary" id="btnSaveSettings">Save</button>
      </div>

      <div class="tiny muted">Tip: Deploy as Web App → Execute as <b>Me (USER_DEPLOYING)</b> to create Calendar invites from your account.</div>
      <div class="small" id="settingsMsg"></div>
    </div>
  </div>

  <!-- USER MODAL -->
  <div class="overlay hidden" id="userOverlay" aria-hidden="true">
    <div class="modal">
      <div class="modal-head">
        <div class="modal-title">Set user name</div>
        <button class="btn btn-ghost btn-sm" id="btnCloseUser">Close</button>
      </div>

      <label class="muted small">User name (stored only on this device)</label>
      <input id="userNameInput" placeholder="Ritesh Kapoor"/>

      <div class="row">
        <button class="btn btn-primary" id="btnSaveUser">Save</button>
      </div>
    </div>
  </div>

  <!-- QR MODAL -->
  <div class="overlay hidden" id="qrOverlay" aria-hidden="true">
    <div class="modal modal-wide">
      <div class="modal-head">
        <div class="modal-title">Scan badge / business card (optional)</div>
        <button class="btn btn-ghost btn-sm" id="btnCloseQr">Close</button>
      </div>
      <div class="tiny muted">Allow camera permission when prompted. Point at QR (vCard recommended) to auto-fill.</div>
      <div id="qrReader" class="qrbox"></div>
      <div class="small" id="qrMsg"></div>
    </div>
  </div>

  <script src="./app.js"></script>
</body>
</html>
